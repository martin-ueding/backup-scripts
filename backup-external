#!/bin/bash
# Copyright (c) 2011 Martin Ueding <dev@martin-ueding.de>

set -u
set -e

targets=("/media/Gamma/Backup" "/media/Sigma/Backup" "/media/USB-Eins/" "/media/USB-Zwei/")
for target in "${targets[@]}"
do
	if [[ -d "$target" ]]
	then
		if which boxes
		then
			echo "$target" | boxes -a c -s 80 -d shell
		fi

		if [[ -f "$target/.small_backup" ]]
		then
			excludefile="$HOME/.syncscripts/exclude_small.txt"
		else
			excludefile="$HOME/.syncscripts/exclude_big.txt"
		fi

		time rsync -avhE --delete --exclude-from "$excludefile" -- /home/mu "$target/home/"
		time rsync -avhE --delete --exclude-from "$excludefile" -- /etc "$target/"
		time rsync -avhE --delete --exclude-from "$excludefile" -- /opt "$target/"
	fi
done
